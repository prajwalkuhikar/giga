import os
import pandas as pd

# Function to filter invalid bounding boxes
def filter_invalid_bboxes(file_path):
    # Read the file into a DataFrame
    df = pd.read_csv(file_path, sep=' ', header=None, names=['class', 'x_center', 'y_center', 'width', 'height'])
    
    # Filter out rows where any of the bbox values are out of the range [0, 1]
    filtered_df = df[(df['x_center'] >= 0) & (df['x_center'] <= 1) &
                     (df['y_center'] >= 0) & (df['y_center'] <= 1) &
                     (df['width'] > 0) & (df['width'] <= 1) &
                     (df['height'] > 0) & (df['height'] <= 1)]
    
    # Save the filtered DataFrame back to the file
    filtered_df.to_csv(file_path, sep=' ', header=False, index=False)

# Path to the directory containing label files
labels_dir = r'C:\Users\DEBIEKPR\Desktop\yolo_test\datasets\tless\labels\val'

# Iterate over all label files in the directory
for filename in os.listdir(labels_dir):
    if filename.endswith('.txt'):
        file_path = os.path.join(labels_dir, filename)
        filter_invalid_bboxes(file_path)
        print(f"Processed {filename}")

print("Finished processing all label files.")
